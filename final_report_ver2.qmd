---
title: "Quantitative Strategies on High Frequency Data"
subtitle: "Final Research Project Report"
author: "Team members: Shintaro Tahara - 477063, Gregorius Ruyoga - 477174"
date: 01/25/2026
date-format: "MMM D, YYYY"
format: pdf
---

## Approaches Undertaken

### Group 1: S&P 500 (SP) and Nasdaq 100 (NQ) Futures

**Core Strategy**: Statistical arbitrage using pairs trading with dynamic beta hedging and adaptive z-score thresholds.

**Methods Explored**:

1. **Beta Calculation Windows**: Tested rolling windows of 300, 450, 600, and 900 minutes
   - Selected 600 minutes for optimal balance between responsiveness and stability

2. **Spread Calculation Windows**: Evaluated 30, 45, 60, and 90 minutes for z-score computation
   - Chose 45 minutes to capture short-term mean reversion opportunities

3. **Entry Thresholds**: Experimented with fixed z-scores (2.0, 2.5, 3.0, 3.5) and adaptive mechanisms
   - Implemented adaptive entry with base threshold of 3.0 and volatility-adjusted sensitivity of 0.5

   - Maximum entry threshold capped at 3.5 to avoid entering during extreme market conditions

4. **Volatility Adjustment**: Tested short-term (120, 180, 240 minutes) vs baseline (600 minutes) volatility windows
   - Selected 180 minutes short-term and 600 minutes baseline for adaptive threshold adjustment

5. **Exit Rules**: Compared mean reversion exits (z=0), partial exits (z=±1.0), and stop-loss mechanisms
   - Final selection: z=0 for profit-taking, z=±5.0 for stop-loss protection

6. **Trading Hours and Cooldown**: Implemented 10:00-15:40 trading window with 30-minute cooldown after exit
   - This prevents overtrading and allows market conditions to stabilize

**Parameter Search Process**: Grid search over parameter combinations on in-sample quarters, optimizing for net Sharpe ratio weighted by absolute PnL (stat metric). Selected configuration that maximized consistency across multiple in-sample periods.

---

#### Alternative Strategies Tested - Group 1

**Strategy 1: Nasdaq 100 Futures Volatility Bollinger Band Strategy**

*Overview*:
Volatility-adjusted Bollinger Band mean reversion strategy applied to NQ futures. The approach uses dynamic bands that expand and contract based on realized volatility, with entry signals generated when price touches the outer bands and exit signals triggered upon reversion to the middle band. Position sizing was kept constant at one contract to isolate signal quality from leverage effects.

*Parameters Tested*:

- **Lookback Window**: 60, 90, 120, 180, 240 minutes (tested to balance signal frequency with noise reduction)

- **Band Width (Standard Deviations)**: 1.5, 2.0, 2.5, 3.0 (wider bands reduce false signals but miss opportunities)

- **Volatility Calculation Method**: Simple standard deviation vs exponentially weighted moving average (20, 40, 60 minute half-lives)

- **Exit Threshold**: Middle band (MA) vs partial reversion (0.5 SD, 1.0 SD from MA)

- **Cooldown Period**: 15, 30, 45, 60 minutes post-exit to prevent immediate re-entry

*Parameter Adjustment Process*:
Started with standard 60-minute lookback and 2 SD bands, then iteratively tested wider bands (2.5, 3.0 SD) and longer windows (120, 180 minutes) on 2023Q1 and Q3. Selected 120-minute lookback with 2.5 SD bands and 30-minute cooldown based on stable stat scores above 0.5 across both quarters.

*Results and Decision*:
Gross Sharpe ratios scored not bad, but net performance suffered from excessive transactions that eroded returns to net SR. Silver's trending behavior during some periods conflicted fundamentally with mean reversion logic, making this approach unsuitable despite parameter optimization.

---

### Group 2: Gold (XAU) and Silver (XAG) Futures

**Core Strategy**: Dual-asset momentum strategy with relative strength filtering.

**Methods Explored**:

1. **Momentum Windows**: Tested lookback periods of 138, 207, 276, and 345 minutes (0.5 to 1.25 trading days)
   - Selected 276 minutes (approximately 1 trading day) for capturing persistent trends

2. **Rebalancing Frequency**: Evaluated continuous (every bar), 138, 276, and 552 minutes
   - Chose 276 minutes to reduce transaction costs while maintaining trend capture

3. **XAG Entry Thresholds**: Tested momentum differentials of 0.0, 0.03, 0.05, and 0.08
   - Selected 0.05 to filter out weak silver signals and reduce whipsaws

**Parameter Search Process**: Sequential optimization starting with momentum window, then rebalancing frequency, finally XAG threshold. Validated on multiple in-sample quarters to ensure robustness. Prioritized strategies with net SR > 1.0 and reasonable transaction frequency.

---

#### Alternative Strategies Tested - Group 2

**Strategy 1: AUD/CAD Range-Bound Mean Reversion Strategy**

*Overview*:
This strategy trades the AUD/CAD exchange rate within a historically stable range.
A center level was identified as the approximate midpoint of the trading range over the sample period. Long positions are taken when the exchange rate moves well below this level, while short positions are taken when it moves well above it. When prices remain close to the center, the strategy stays flat to avoid trading in low-conviction, range-bound conditions.

*Parameters Tested*:

- **Center Reference Level**: 0.9, 0.93, 0.95, 0.97

- **Entry Distance from Center**: 0.02, 0.03, 0.04, 0.05

- **Profit-Taking Threshold**: Return to center, partial reversion (0.01, 0.015 from center)

- **Stop-Loss Boundaries**: Range breakdown levels at 0.85 (lower) and 1.05 (upper)

- **Neutral Zone Width**: ±0.01, ±0.015, ±0.02 around center

- **Position Holding Period**: Until profit target or stop-loss vs time-based exit (3 days, 5 days, 7 days maximum hold)

*Parameter Adjustment Process*:
Iteratively tested entry distances and profit targets using daily closing prices.

*Results*:
Achieved moderate gross SR  during stable periods but net SR dropped after costs.

---

## Finally Selected Strategy for Group 1

**Strategy Type**: Pairs trading with dynamic beta hedging

**Core Logic**:

- Long/short positions in NQ based on spread deviation from rolling mean

- Opposite positions in SP to hedge beta exposure

- Adaptive entry thresholds respond to changing volatility regime

**Final Parameters**:

- Spread calculation window: 45 minutes

- Beta estimation window: 600 minutes

- Short-term volatility window: 180 minutes

- Baseline volatility window: 600 minutes

- Base z-score entry threshold: 3.0

- Adaptive sensitivity: 0.5

- Maximum entry threshold: 3.5

- Exit threshold: z = 0.0 (mean reversion)

- Stop-loss: z = ±5.0

- Cooldown period: 30 minutes after exit

**Entry Logic**:

- Enter short NQ / long SP when z > (3.0 + max(0, (vol_ratio - 1.0) × 0.5)), capped at 3.5

- Enter long NQ / short SP when z < -(3.0 + max(0, (vol_ratio - 1.0) × 0.5)), capped at -3.5

- No entry during cooldown period

**Exit Logic**:

- Close position when z crosses 0 or hits stop-loss at ±5.0

- Mandatory exit at 15:40 EST

**Rationale for Selection**:
We chose the SP/NQ pairs approach over the NQ Bollinger Band strategy for three reasons. The SP–NQ spread exhibits reliable mean reversion, while standalone NQ often trends and breaks mean-reversion signals. Adaptive entry thresholds and a cooldown cut overtrading and improve transaction-cost efficiency. The pairs structure also provides natural beta hedging and reduces directional exposure, making it more robust in volatile periods where fixed Bollinger Bands struggle to adapt.

```{python}
#| echo: false
#| output: false
import runpy
runpy.run_path("final_strategy_group1_with_oos.py")
```

---

## Quarterly Performance Statistics - Group 1
```{python}
#| echo: false
import pandas as pd
from IPython.display import display

# Load summary data
try:
    # Read CSV without header (contains 9 columns now)
    summary_data1_full = pd.read_csv("summary_data1_all_quarters.csv", header=None)

    # Update columns to include 'gross_CR' (Total 9 columns)
    summary_data1_full.columns = ['quarter', 'gross_SR', 'net_SR', 'gross_PnL',
                             'net_PnL', 'gross_CR', 'net_CR', 'av_daily_ntrans', 'stat']

    # Coerce numeric columns to numbers
    numeric_cols = ['gross_SR', 'net_SR', 'gross_PnL', 'net_PnL', 'gross_CR', 'net_CR', 'av_daily_ntrans', 'stat']
    for col in numeric_cols:
        summary_data1_full[col] = pd.to_numeric(summary_data1_full[col], errors='coerce')

    # Drop rows that might be accidental headers
    summary_data1_full = summary_data1_full.dropna(subset=['net_SR'])

    # Format the table
    styled_table1_full = (
        summary_data1_full.style
        .format("{:.2f}", subset=numeric_cols)
        .set_properties(**{"text-align": "right"})
        .set_table_styles([
            {"selector": "th", "props": [("font-size", "10px"), ("text-align", "center")]},
            {"selector": "td", "props": [("font-size", "10px")]}
        ])
        .hide(axis="index")
    )
    display(styled_table1_full)
except Exception as e:
    print(f"Error loading table: {e}")
```

**Analysis**:

[Analysis to be added]

---

## Cumulative Equity Curve for Group 1 (All Quarters)
```{python}
#| echo: false
#| out-width: 100%
from IPython.display import Image
Image(filename="Cumulative_Line_all_g1.png")
```

---

## Finally Selected Strategy for Group 2

**Strategy Type**: Momentum-based directional trading with relative strength filtering

**Core Logic**:
- Take long/short positions in XAU based on momentum relative to XAG
- Add XAG position only when momentum differential exceeds threshold
- Mandatory flat positions during overnight session (16:50-18:10 EST)

**Final Parameters**:
- Momentum calculation window: 276 minutes (~1 trading day)
- Rebalancing frequency: 276 minutes
- XAG momentum threshold: 0.05
- Flat zone: 16:50 - 18:10 EST (overnight session)

**Entry Logic**:
- **XAU position** (rebalanced every 276 minutes):

  - Long XAU if momentum_XAU > momentum_XAG

  - Short XAU if momentum_XAU < momentum_XAG

- **XAG position** (rebalanced every 276 minutes):

  - Long XAG if momentum_XAG > (momentum_XAU + 0.05)

  - Short XAG if momentum_XAG < (momentum_XAU - 0.05)

  - Flat XAG if momentum_XAG - momentum_XAU| ≤ 0.05

**Exit Logic**:
- Positions maintained until next rebalancing signal

- Mandatory flat during 16:50-18:10 EST

**Rationale for Selection**:
The momentum approach was chosen for its adaptability and stronger empirical performance versus the AUD/CAD range strategy. It requires no fixed equilibrium, concentrates exposure on the stronger metal via a relative-strength filter, and delivers cleaner signals with fewer trades and lower transaction costs.

```{python}
#| echo: false
#| output: false
import runpy
runpy.run_path("final_strategy_group2_with_oos.py")
```

---

## Summary of Results for Group 2
```{python}
#| echo: false
import pandas as pd

# Load summary data
try:
    summary_data2 = pd.read_csv("summary_data2_all_quarters(XAUandXAG).csv")

    # If CSV has headers, use them; otherwise assign column names
    if 'quarter' not in summary_data2.columns:
        summary_data2.columns = ['quarter', 'gross_SR', 'net_SR', 'gross_PnL',
                                 'net_PnL', 'gross_CR', 'net_CR', 'av_daily_ntrans', 'stat']

    # Coerce numeric columns to numbers
    numeric_cols = [col for col in summary_data2.columns if col != 'quarter']
    for col in numeric_cols:
        summary_data2[col] = pd.to_numeric(summary_data2[col], errors='coerce')

    # Drop rows that might be problematic
    summary_data2 = summary_data2.dropna(subset=['net_SR'])

    # Format the table
    styled_table2 = (
        summary_data2.style
        .format("{:.2f}", subset=numeric_cols)
        .set_properties(**{"text-align": "right"})
        .set_table_styles([
            {"selector": "th", "props": [("font-size", "10px"), ("text-align", "center")]},
            {"selector": "td", "props": [("font-size", "10px")]}
        ])
        .hide(axis="index")
    )
    display(styled_table2)
except Exception as e:
    print(f"Error loading table: {e}")
```

---

## Cumulative Equity Curve for Group 2 (All Quarters)
```{python}
#| echo: false
#| out-width: 100%
from IPython.display import Image
Image(filename="Cumulative_Line_all_g2.png")
```

**Analysis**:

The SP/NQ pairs trading strategy exhibits three distinct performance phases over the 12-quarter test period:

**Phase 1 - Early Success (2023 Q1-Q2)**: The strategy demonstrated exceptional performance with net Sharpe ratios of 2.20 and 1.63, generating net PnL of $4,530 and $5,431 respectively. Transaction costs were well-managed despite moderate trading frequency (2-3 trades/day), and the strategy effectively captured mean-reversion opportunities during relatively stable market conditions.

**Phase 2 - Extended Deterioration (2023 Q3 - 2024 Q3)**: Six consecutive quarters of underperformance, with most quarters showing negative or near-zero net Sharpe ratios. The worst performance occurred in 2024 Q2 (net SR: -2.21, net PnL: -$4,300). Transaction costs consistently eroded gross profits during this period, indicating reduced signal quality rather than overtrading. The persistent gap between gross and net performance suggests the market regime shifted toward trending behavior that reduced mean-reversion opportunities.

**Phase 3 - Recovery (2024 Q4 - 2025 Q4)**: Progressive improvement culminating in exceptional Q4 2025 performance (net SR: 3.52, net PnL: $3,722). Transaction frequency stabilized around 1.5-1.7 trades/day, improving cost efficiency. The adaptive threshold mechanism appears to have successfully adjusted to the new volatility regime, with the stat metric returning to positive territory.

**Transaction Cost Impact**: Throughout 2024, transaction costs consumed approximately $3,000-4,000 per quarter despite stable trading frequency, emphasizing that signal quality degradation, not overtrading, drove underperformance.

**Out-of-Sample Performance**: Mixed results in OOS periods (shaded in the equity curve), with both strong quarters (2025 Q2, Q4) and weak ones (2024 Q2, Q3), suggesting moderate robustness but some vulnerability to regime changes.
---

## Summary and Conclusions

### Overall Performance Assessment


1. **Group 1 (SP/NQ Pairs Trading)**:

   - **Final Cumulative Net PnL**: Approximately $17,000 over 12 quarters
   - **Risk Profile**: Conservative with controlled drawdowns and no catastrophic losses
   - **Consistency**: Moderate - experienced an 18-month flat period but recovered without severe capital impairment
   - **Transaction Cost Sensitivity**: High - performance deteriorated significantly when signal quality declined, with costs consuming $3,000-4,000 per quarter during 2024
   - **Regime Adaptability**: Limited - struggled during trending market conditions from 2023 Q3 through 2024 Q3, but adaptive thresholds eventually helped recovery
   - **Deployment Viability**: Suitable for risk-averse applications or as a portfolio diversifier, providing steady but modest returns without exposing capital to severe tail risk
   - **Key Strength**: Beta hedging and adaptive mechanisms provided defensive characteristics during adverse conditions
   - **Key Weakness**: Extended periods of underperformance when mean-reversion opportunities diminished

2. **Group 2 (XAU/XAG Momentum)**:

   - **Final Cumulative Net PnL**: Approximately $3,000 (after catastrophic 2025 Q4 drawdown from $50,000 peak)
   - **Risk Profile**: Aggressive with extreme volatility and severe tail risk
   - **Consistency**: Poor - alternated between exceptional gains and devastating losses
   - **Best Quarter**: 2024 Q4 with $20,875 net profit (net SR: 2.05)
   - **Worst Quarter**: 2025 Q4 with -$47,360 net loss (net SR: -4.56), representing a 94% drawdown from peak equity
   - **Regime Dependency**: Extreme - thrived during persistent trends but catastrophically failed during reversals
   - **Deployment Viability**: Not suitable for deployment without substantial enhancements to risk management, particularly momentum reversal protection and dynamic position sizing
   - **Key Strength**: Captured large directional moves efficiently during favorable regimes
   - **Key Weakness**: Complete lack of protection against sudden momentum reversals led to unacceptable drawdowns

**Comparative Assessment**: Group 1's pairs trading approach proved more robust overall, delivering steady positive returns with controlled risk despite a prolonged underperformance period. Group 2's momentum strategy, while capable of generating superior returns during favorable conditions, exhibited unacceptable tail risk that ultimately destroyed most accumulated gains. The contrast highlights the fundamental tradeoff between aggressive return-seeking strategies and defensive capital preservation approaches.

### Key Learnings

1. **Transaction Cost Impact on Signal Quality**: Group 1's experience demonstrates how transaction costs become particularly destructive when signal quality degrades. During 2024, stable trading frequency (~1.7 trades/day) still resulted in significant cost drag because the underlying mean-reversion signals weakened. This emphasizes that cost management requires not just limiting trade frequency, but maintaining high-quality entry signals. The adaptive entry threshold mechanism helped by raising the bar for trade initiation during elevated volatility, but proved insufficient during the full regime shift.

2. **Regime Detection is Critical**: Both strategies suffered from lack of explicit regime detection mechanisms. Group 1's mean-reversion approach failed during trending markets (2023 Q3 - 2024 Q3), while Group 2's momentum approach catastrophically failed during reversals (2024 Q3, 2025 Q4). A meta-strategy incorporating regime classification (trending vs. mean-reverting vs. choppy) could dynamically allocate between strategies or adjust position sizing based on current market conditions. Technical indicators like ADX, volatility metrics, or machine learning classifiers trained on historical regime patterns could provide early warning signals.

3. **Risk Management Cannot Be an Afterthought**: Group 2's devastating 2025 Q4 collapse (losing $44,000 or 94% from peak) illustrates the danger of momentum strategies without adequate reversal protection. The strategy's time-based rebalancing continued holding directional positions as trends reversed, with no mechanism to detect or respond to momentum breakdown. Potential improvements include: (a) momentum strength filters that reduce exposure when momentum weakens, (b) trailing stops based on recent peak/trough levels, (c) volatility-adjusted position sizing that scales down during high-volatility regimes, and (d) maximum drawdown limits that force position flattening after losses exceed thresholds.

4. **Overfitting Manifestations in Out-of-Sample Performance**: Both strategies showed degraded OOS performance, but Group 2's catastrophic Q4 2025 failure is particularly instructive. The parameters optimized on in-sample quarters (276-minute momentum window, 0.05 XAG threshold) likely captured characteristics of specific trend episodes that did not generalize. More conservative parameter selection with larger safety margins, validation across multiple market regimes, and walk-forward optimization could improve robustness. Additionally, the stat metric (net SR weighted by absolute PnL) may have overemphasized performance during strong trending periods, leading to parameter sets that maximize gains in favorable conditions while underestimating tail risk.

5. **Adaptive Mechanisms Provide Value**: Group 1's volatility-adjusted entry thresholds demonstrated value during the 2024 Q4 - 2025 recovery phase. When volatility increased, the strategy automatically raised entry requirements, reducing exposure during uncertain conditions. This adaptive behavior helped the strategy eventually recover after the extended drawdown. Group 2 would benefit from similar adaptive features, such as: (a) momentum strength thresholds that adjust based on recent volatility, (b) position sizing that scales with confidence measures, and (c) rebalancing frequency that adapts to market regime (more frequent in choppy conditions, less frequent in strong trends).

6. **Pairs Trading Provides Natural Hedging**: Group 1's structure of opposing positions in correlated assets (long NQ / short SP or vice versa) provided inherent protection against broad market moves. This beta-neutral design reduced directional exposure and contributed to controlled drawdowns. Even during the worst quarter (2024 Q2), the loss remained moderate (-$4,300) compared to Group 2's catastrophic failures. This emphasizes the value of hedged structures in systematic trading strategies.

7. **Strategy Diversification Benefits**: The complementary nature of mean-reversion (Group 1) and momentum (Group 2) approaches suggests potential benefits from portfolio allocation between both strategies. A combined approach with dynamic weighting based on recent performance, regime indicators, or volatility metrics could smooth returns and reduce drawdown severity. For example, increasing allocation to pairs trading during high-volatility choppy regimes, while favoring momentum during stable trending regimes, could improve risk-adjusted returns.

8. **The Importance of Explicit Stop-Loss Rules**: Group 1's z = ±5.0 stop-loss proved more effective at limiting losses than Group 2's pure time-based rebalancing. Having explicit exit rules based on adverse price movements (rather than waiting for the next rebalancing signal) provides critical protection when initial trade thesis breaks down. Group 2 would benefit from incorporating similar protective stops based on momentum reversal signals or drawdown thresholds.

9. **Cost-Benefit Tradeoffs in Parameter Optimization**: Group 1's extended parameter search (testing 4 beta windows × 4 spread windows × 5 entry thresholds × 3 volatility windows = 240+ combinations) likely contributed to better generalization than Group 2's sequential optimization. However, both strategies showed overfitting signs in OOS periods. This suggests diminishing returns from parameter optimization beyond a certain point, and the importance of reserving substantial data for true OOS validation rather than using all available data for parameter tuning.

10. **Transaction Cost Modeling Accuracy Matters**: Both strategies' net performance differed substantially from gross performance, with typical cost drag of $2,000-4,000 per quarter. Accurate modeling of slippage, bid-ask spreads, and market impact during strategy development is crucial for realistic performance assessment. Strategies that appear profitable gross-of-costs may be unviable net-of-costs, particularly for higher-frequency approaches or during low-volatility regimes when edge is minimal.

---


### Key Learnings

- To be added

---